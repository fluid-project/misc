<html>
	<head>
		<script type="text/javascript" language="javascript" src="../lib/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" language="javascript" src="../lib/jquery-ui-1.8.min.js"></script>
		<script type="text/javascript" language="javascript" src="../lib/fluid-all-1.2.min.js"></script>
		<script type="text/javascript" language="javascript" src="../js/batched-pager.js"></script>
		<script type="text/javascript" language="javascript" src="../data/batchdata.js"></script>
		
		<style type="text/css">
			.view-pager ul {margin:0; padding:0;}
			.fl-pager .fl-pager-ui li { list-style-type:none; display:inline-block; margin-right:0.5em; }
			.fl-pager caption {padding:.63em 0em; margin-bottom:0em;}
			.fl-pager th {cursor:pointer;}
			.fl-pager th a {color:#3d80b3; text-decoration:none;}
			.fl-pager th a:hover {color:#2694e8; text-decoration:none;}
			.fl-pager-controls {padding:.69em .69em;}
			.flc-pager-links a {color:#666666; text-decoration:none; vertical-align:middle;}
			.flc-pager-links a:hover {color:#333333;}
		</style>
	</head>
	<body>
		<div id="pager" class="fl-pager">
			<div class="flc-pager-top">
	          <ul id="pager-top" class="fl-pager-ui">
	            <li class="flc-pager-previous"><a href="javascript:;">&lt; prev</a></li>
	            <li>
	              <ul class="fl-pager-links flc-pager-links" style="margin:0; display:inline">
	                <li class="flc-pager-pageLink"><a href="javascript:;">1</a></li>
	                <li class="flc-pager-pageLink-disabled">2</li>
	                <li class="flc-pager-pageLink"><a href="javascript:;">3</a></li>
	              </ul>
	            </li>
	            <li class="flc-pager-next"><a href="javascript:;">next &gt;</a></li>
	            <li>
	              <span class="flc-pager-summary">page</span>
	              <span> <select class="pager-page-size flc-pager-page-size">
	              <option value="5">5</option>
	              <option value="10">10</option>
	              <option value="20">20</option>
	              <option value="50">50</option>
	              </select></span> per page
	            </li>
	          </ul>
	        </div>

			<table summary="Test pager table">
				<thead rsf:id="header:">
					<tr>
						<th id="index" class="index-header flc-pager-sort-header"><a rsf:id="index" href="javascript:;">Index</a></th>
						<th id="title" class="title-header flc-pager-sort-header"><a rsf:id="title" href="javascript:;">Title</a></th>
					</tr>
				</thead>
				<tbody>
					<tr rsf:id="row:">
						<td headers="index" rsf:id="index">0</td>
						<td headers="title" rsf:id="title">A Random Title</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<script type="text/javascript">
		
			/*
			 *  Test batching function.  A more interesting implementation might go get new data via an
			 *  AJAX request.
			 */
			var batchFunction = function(start, size, sortKey, sortDir) {
				console.log("getting new data for batch [" + start + " to " + (start+size) + "] with sort key " + sortKey + " in direction " + sortDir);
				data.sort(getSortFunction(sortKey, sortDir));
				return data.slice(start, Math.min(start+size, data.length));
			};
			
			/*
			 *  Test data length function
			 */
			var dataLengthFunction = function() {
				return data.length;
			}
			
			/*
			 *  Test sort function.
			 */
			var getSortFunction = function(sortKey, sortDir) {
				// ensure legal input
				if (sortDir != -1 && sortDir != 1) sortDir = 1;
				if (sortKey != 'title' && sortKey != 'index') sortKey = 'index';
				
				return function(a, b) {
					if (a[sortKey] < b[sortKey]) return -sortDir;
					else if (a[sortKey] > b[sortKey]) return sortDir;
					else return 0;
				};
			};
			
	
			$(document).ready(function() {
				var options = {
					pagerOptions: {
	                    columnDefs: [
	                        { key: "index", valuebinding: "*.index", sortable: true },
	                        { key: "title", valuebinding: "*.title", sortable: true }
	                    ],
	                    bodyRenderer: {
	                      type: "fluid.pager.selfRender",
	                      options: {
	                          selectors: {
	                             root: "table"
	                          },
	                          row: "row:"
	                      }
	                    },
	                    pagerBar: {type: "fluid.pager.pagerBar", options: {
	                      pageList: {type: "fluid.pager.renderedPageList",
	                        options: { 
	                          linkBody: "a"
	                        }
	                      }
	                    }},
					},
					dataFunction: batchFunction,
					dataLengthFunction: dataLengthFunction
                };
                unicon.batchedpager("#pager", options);
                
	        });

		</script>
	</body>
</html>
		